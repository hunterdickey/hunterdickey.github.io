aes(
x = DATE,
y = model_pge$residuals
)
) +
geom_line() +
geom_smooth(method = "lm", se = F) +
labs(
x = "",
y = "Average kBTU/Customer",
title = "Residuals from previous regression"
)
install.packages("readxl")
install.packages("readxl")
knitr::opts_chunk$set(echo = F, warning = F, message = F)
library("readxl")
ces_data_4 <- read_excel("calenviroscreen40resultsdatadictionary_F_2021.xlsx")
library("readxl")
library(readxl)
ces_data_4 <- read_excel("calenviroscreen40resultsdatadictionary_F_2021.xlsx")
ces_data_4 <- read_excel("calenviroscreen40resultsdatadictionary_F_2021.xlsx", sheet =1)
ces_data_4 <- read_excel("calenviroscreen40resultsdatadictionary_F_2021.xlsx")
View(ces_data_4)
ces_data_4$`California County`
bay_ces_data_4 <- ces_data_4$`California County`[c("Alameda","Napa","Santa Clara", "Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),]
bay_ces_data_4 <- ces_data_4$`California County`[c("Alameda","Napa","Santa Clara", "Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma")]
bay_ces_data_4 <- ces_data_4$`California County`[c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma")]
bay_ces_data_4 <- ces_data_4$`California County`["alameda"]
bay_ces_data_4
bay_ces_data_4 <- ces_data_4$`California County
bay_ces_data_4 <- ces_data_4$`California County'
bay_ces_data_4 <- ces_data_4$`California County`
bay_ces_data_4 <- ces_data_4[ces_data_4$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma")]
bay_ces_data_4 <- ces_data_4[ces_data_4$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),]
View(bay_ces_data_4)
leaflet() %>%
addTiles() %>%
addPolygons(
data = bay_ces_data_4
) %>%
addMarkers(
data = bay_ces_data_4 %>%
st_centroid()
)
library(tidyverse)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(tigris)
install.packages("readxl")
library(sf)
library(mapview)
library(tigris)
install.packages("readxl")
library(readxl)
install.packages("readxl")
install.packages("readxl")
leaflet() %>%
addTiles() %>%
addPolygons(
data = bay_ces_data_4
) %>%
addMarkers(
data = bay_ces_data_4 %>%
st_centroid()
)
library(leaflet)
leaflet() %>%
addTiles() %>%
addPolygons(
data = bay_ces_data_4
) %>%
addMarkers(
data = bay_ces_data_4 %>%
st_centroid()
)
st_crs(bay_ces_data_4)
ca_counties <- counties("CA", cb = T, progress_bar = F)
ca_counties <- counties("CA", cb = T, progress_bar = F)
st_crs(ca_counties)
mapview(ca_counties)
leaflet() %>%
addTiles() %>%
addPolygons(
data = ca_counties
) %>%
addMarkers(
data = ca_counties %>%
st_centroid()
)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
mapview(bay_counties)
bay_education_income_tract <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "tract:*",
regionin = "state:06+county:001,013,041,055,075,081,085,095,097",
vars = c(
"B06009_001E",
"B06009_002E",
"B06009_003E",
"B19001_001E",
"B19001_014E",
"B19001_015E",
"B19001_016E",
"B19001_017E"
)
) %>%
transmute(
tract = paste0(state, county, tract),
perc_college = 1 - (B06009_002E + B06009_003E) / B06009_001E,
perc_over100k = (B19001_014E + B19001_015E + B19001_016E + B19001_017E) / B19001_001E
) %>%
filter(
!is.na(perc_college),
!is.na(perc_over100k)
)
View(bay_education_income_tract)
bay_asthma_tract <-
bay_ces_data_4[, "Census Tract", "Asthma"]
bay_asthma_tract <-
bay_ces_data_4["Census Tract", "Asthma"]
View(bay_asthma_tract)
bay_asthma_tract <- rbind(bay_ces_data_4$`Census Tract`, bay_ces_data_4$Asthma)
View(bay_asthma_tract)
bay_asthma_tract <- cbind(bay_ces_data_4$`Census Tract`, bay_ces_data_4$Asthma)
View(bay_asthma_tract)
View(bay_asthma_tract)
bay_asthma_tract <- cbind(bay_ces_data_4$`Census Tract`, bay_ces_data_4$Asthma)%>%
transmute(
tract = paste0(state, county, tract))
bay_asthma_tract <- cbind(bay_ces_data_4$`Census Tract`, bay_ces_data_4$Asthma)
names(bay_asthma_tract)[1] <- 'Census Tract'
View(bay_asthma_tract)
names(bay_asthma_tract)[names(bay_asthma_tract) == 'V1'] <- "PCLASS'
names(bay_asthma_tract)[names(bay_asthma_tract) == 'V1'] <- "PCLASS"
names(bay_asthma_tract)[names(bay_asthma_tract) == 'V1'] <- "PCLASS"
ces_data_4 <- read_excel("calenviroscreen40resultsdatadictionary_F_2021.xlsx")
names(bay_asthma_tract)[names(bay_asthma_tract)== 'V1'] <- "PCLASS"
names(titanic_df)[1] <- 'P_Class'
names(bay_asthma_tract)[1] <- 'P_Class'
View(bay_asthma_tract)
data.frame(bay_asthma_tract)
colnames(ces_data_4)
View(bay_asthma_tract)
colnames(bay_asthma_tract)
bay_asthma_tract <- data_frame(bay_ces_data_4$`Census Tract`, bay_ces_data_4$Asthma)
View(bay_asthma_tract)
bay_asthma_tract <- data_frame(bay_ces_data_4$`Census Tract`, bay_ces_data_4$Asthma)
colnames(bay_asthma_tract)
names(bay_asthma_tract)[1] <- 'Census Track'
names(bay_asthma_tract)[2] <- 'Asthma'
ces4_clean <- ces4 %>%
select(!ends_with("Pctl"))
ces4_clean <- ces_data_4 %>%
select(!ends_with("Pctl"))
ces4_clean <- ces_data_4 %>%
select(!ends_with("Pctl"))
ces4_clean <- ces_data_4 %>%
select(!ends_with("Pctl"))
sum(ces4_clean$Poverty)
sum(is.na(ces4_clean$Poverty))
ces4_clean$Poverty
ca_tracts <- tracts("CA")
class(ces4$'Census Tract')
class(ces4_clean$'Census Tract')
class(ca_tracts$GEOID)
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
select(GEOID) %>%
mutate(GEOID = as.numeric(GEOID)),
by = c("Census Tract" = "GEOID")
)
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = as.numeric(GEOID)),
by = c("Census Tract" = "GEOID")
)
ces4_map
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = as.numeric(GEOID)),
by = c("Census Tract" = "GEOID")
) %>%
st_as_sf()
mapview(ces4_map, zcol = "Asthma")
View(ces4_map)
# mutate function
bay_ces4_map <- ces4_map[ces4_map$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),]
bay_ces4_map <- ces4_map[ces4_map$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),]
mapview(bay_ces4_map, zcol = "Asthma")
View(bay_ces4_map)
bay_ces4_map <- ces4_map[ces4_map$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),]
mapview(bay_ces4_map, zcol = "Asthma")
View(ces4_map)
bay_ces4_map <- ces4_map[ces4_map$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),na.rm = F]
bay_ces4_map <- ces4_map[ces4_map$`California County`== c("Alameda","Napa","Santa Clara","Contra Costa","San Francisco","Solano","Marin","San Mateo","Sonoma"),na.rm = F]
mapview(bay_ces4_map, zcol = "Asthma")
mapview(bay_ces4_map)
mapview(ces4_map)
mapview(ces4_map, zcol = "Asthma")
sum(ces4_map[ces4_map$`California County`== "Santa Clara"])
sum(ces4_map[ces4_map$`California County`== "Santa Clara"], "California County")
length(ces4_map[ces4_map$`California County`== "Santa Clara"], "California County")
total(ces4_map[ces4_map$`California County`== "Santa Clara"], "California County")
unique(ces4_map[ces4_map$`California County`== "Santa Clara"], "California County")
unique(bay_ces4_map[bay_ces4_map$`California County`== "Santa Clara"], "California County")
mapview(ces4_map[ces4_map$`California County`== "Alameda"], zcol = "Asthma")
mapview(ces4_map$`California County`== "Alameda", zcol = "Asthma")
mapview(bay_ces4_map)
length(ces4_map$`California County` == "Alameda")
length(bay_ces4_map$`California County` == "Alameda")
bay_ces4_map_a <- ces4_map[ces4_map$`California County`== "Alameda"]
bay_ces4_map_a <- ces4_map[ces4_map$`California County`== "Alameda",]
View(bay_ces4_map_a)
View(ces4_map)
bay_ces4_map_n <- ces4_map[ces4_map$`California County`== "Napa",]
bay_ces4_map_sc <- ces4_map[ces4_map$`California County`== "Santa Clara",]
bay_ces4_map_cc <- ces4_map[ces4_map$`California County`== "Contra Costa",]
bay_ces4_map_sf <- ces4_map[ces4_map$`California County`== "San Francisco",]
bay_ces4_map_s <- ces4_map[ces4_map$`California County`== "Solano",]
bay_ces4_map_m <- ces4_map[ces4_map$`California County`== "Marin",]
bay_ces4_map_sm <- ces4_map[ces4_map$`California County`== "San Mateo",]
bay_ces4_map_s <- ces4_map[ces4_map$`California County`== "Sonoma",]
bay_ces4_map_a <- ces4_map[ces4_map$`California County`== "Alameda",]
rbind(bay_ces4_map_a,bay_ces4_map_n,bay_ces4_map_sc,bay_ces4_map_cc,bay_ces4_map_sf,bay_ces4_map_s,bay_ces4_map_m,bay_ces4_map_sm,bay_ces4_map_s)
fin_bay_ces4_map <- rbind(bay_ces4_map_a,bay_ces4_map_n,bay_ces4_map_sc,bay_ces4_map_cc,bay_ces4_map_sf,bay_ces4_map_s,bay_ces4_map_m,bay_ces4_map_sm,bay_ces4_map_s)
mapview(fin_bay_ces4_map)
length(ces4_map$`California County` == "Alameda")
length(fin_bay_ces4_map$`California County` == "Alameda")
nrow(ces4_map$`California County` == "Alameda")
length(ces4_map$`California County` == "Alameda",)
length(fin_bay_ces4_map$`California County` == "Alameda")
mapview(fin_bay_ces4_map, zcol = "Asthma")
mapview(fin_bay_ces4_map, zcol = "Asthma")
mapview(fin_bay_ces4_map, zcol = "PM2.5")
setwd("~/Documents/GitHub/hunterdickey.github.io")
mapview(fin_bay_ces4_map)
mapview(fin_bay_ces4_map, zcol = "PM2.5")
mapview(fin_bay_ces4_map, zcol = "Asthma")
asthma <- mapview(fin_bay_ces4_map, zcol = "Asthma")
asthma <- mapview(fin_bay_ces4_map, zcol = "Asthma")
PM2.5 <- mapview(fin_bay_ces4_map, zcol = "PM2.5")
ggplot() +
geom_point(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
)
ggplot() +
geom_point(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
) +
geom_point() +
geom_smooth(method = "lm")
ggplot() +
geom_point(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
) +
geom_point() +
geom_smooth(method = "lm")
ggplot() +
geom_point(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
)+
geom_point() +
geom_smooth(method = "lm")
ggplot(
data = bay_education_income_tract,
aes(
x = perc_college,
y = perc_over100k
)
) +
geom_point() +
geom_smooth(method = "lm")
ggplot() +
geom_point(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
) +
geom_point() +
geom_smooth(method = "lm")
ggplot(
data = bay_education_income_tract,
aes(
x = perc_college,
y = perc_over100k
)
) +
geom_point() +
geom_smooth(method = "lm")
asthma = NULL
P2.5= NULL
ggplot() +
geom_point(
data = bay_education_income_tract,
aes(
x = perc_college,
y = perc_over100k
)
)
ggplot(
data = bay_education_income_tract,
aes(
x = perc_college,
y = perc_over100k
)
) +
geom_point() +
geom_smooth(method = "lm")
PM2.5 = NULL
ggplot(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
) +
geom_point() +
geom_smooth(method = "lm")
model <- lm(Asthma ~ PM2.5, fin_bay_ces4_map)
summary(model)
yintercept <- mean(fin_bay_ces4_map$Asthma)
slope <- 0
best_fit_candidate <- slope * fin_bay_ces4_map$PM2.5 + yintercept
residuals <- fin_bay_ces4_map$Asthma - best_fit_candidate
sumsq_residuals <- sum(residuals^2)
sumsq_residuals
sumsq_residuals
yintercept <- mean(fin_bay_ces4_map$Asthma)
yintercept
yintercept <- mean(fin_bay_ces4_map$Asthma)
yintercept
class(fin_bay_ces4_map$Asthma)
mean(fin_bay_ces4_map$Asthma)
View(fin_bay_ces4_map)
yintercept <- sum(fin_bay_ces4_map$Asthma)
yintercept
yintercept <- mean(fin_bay_ces4_map$Asthma)
plot(density(residuals(model)))
model_log <- lm(log(Asthma) ~ PM2.5, fin_bay_ces4_map)
plot(density(residuals(model_log)))
mapview(fin_bay_ces4_map, zcol= "Asthma")
mapview(fin_bay_ces4_map, zcol= "PM2.5")
ggplot(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = Asthma
)
) +
geom_point() +
geom_smooth(method = "lm")
model <- lm(Asthma ~ PM2.5, fin_bay_ces4_map)
model_log <- lm(log(Asthma) ~ PM2.5, fin_bay_ces4_map)
summary(model)
slope <- 0
yintercept <- mean(fin_bay_ces4_map$Asthma)
best_fit_candidate <- slope * fin_bay_ces4_map$PM2.5 + yintercept
residuals <- fin_bay_ces4_map$Asthma - best_fit_candidate
sumsq_residuals <- sum(residuals^2)
sumsq_residuals
yintercept <- mean(fin_bay_ces4_map$Asthma[1:2])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1584])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1583])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:100])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1000])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:2000])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1500])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1200])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1300])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1400])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1500])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1480])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1485])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1482])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1483])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1484])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1485])
yintercept <- mean(fin_bay_ces4_map$Asthma[1:1484])
yintercept <- mean(fin_bay_ces4_map$Asthma,na.rm=TRUE)
best_fit_candidate <- slope * fin_bay_ces4_map$PM2.5 + yintercept
residuals <- fin_bay_ces4_map$Asthma - best_fit_candidate
sumsq_residuals <- sum(residuals^2)
sumsq_residuals
residuals <- c(fin_bay_ces4_map$Asthma - best_fit_candidate, na.rm=TRUE)
sumsq_residuals <- sum(residuals^2)
sumsq_residuals
residuals <- fin_bay_ces4_map$Asthma - best_fit_candidate %>% na.rm=TRUE
residuals <- fin_bay_ces4_map$Asthma - best_fit_candidate
sumsq_residuals <- sum(residuals^2)
residuals^2
sumsq_residuals <- sum(residuals^2)
sumsq_residuals <- sum(residuals^2)
sumsq_residuals
fin_bay_ces4_map$residuals <- fin_bay_ces4_map$Asthma - best_fit_candidate
sumsq_residuals <- sum(residuals^2)
sumsq_residuals
best_fit_candidate
sumsq_residuals <- c(sum(residuals^2), na.rm= TRUE)
sumsq_residuals <- sum(fin_bay_ces4_map$residuals, na.rm= TRUE)
sumsq_residuals
plot(density(residuals(model)))
# Rep. Q2
ggplot(
data = fin_bay_ces4_map,
aes(
x = PM2.5,
y = log(Asthma)
)
) +
geom_point() +
geom_smooth(method = "lm")
model_log <- lm(log(Asthma) ~ PM2.5, fin_bay_ces4_map)
summary(model_log)
#Question 5
plot(density(residuals(model_log)))
mapview(fin_bay_ces4_map, zcol= "residuals")
mapview(fin_bay_ces4_map, zcol= "residuals", na.rm=TRUE)
mapview(fin_bay_ces4_map, zcol= "Asthma")
mapview(fin_bay_ces4_map, zcol= "residuals")
min(fin_bay_ces4_map$residuals)
min(fin_bay_ces4_map$residuals, na.rm=TRUE)
mapview(fin_bay_ces4_map, zcol= "residuals")
fin_bay_ces4_map[fin_bay_ces4_map$residuals ==min(fin_bay_ces4_map$residuals)], na.rm=TRUE,)
fin_bay_ces4_map[fin_bay_ces4_map$residuals ==min(fin_bay_ces4_map$residuals)], na.rm=TRUE)
fin_bay_ces4_map[fin_bay_ces4_map$residuals ==min(fin_bay_ces4_map$residuals)] na.rm=TRUE,)
fin_bay_ces4_map[fin_bay_ces4_map$residuals ==min(fin_bay_ces4_map$residuals)], na.rm=TRUE,)x
fin_bay_ces4_map[fin_bay_ces4_map$residuals ==min(fin_bay_ces4_map$residuals),]
a <- fin_bay_ces4_map[fin_bay_ces4_map$residuals ==min(fin_bay_ces4_map$residuals),]
a
a <- fin_bay_ces4_map[fin_bay_ces4_map$residuals ==-43.16571,]
a
a <- whichrow(fin_bay_ces4_map[fin_bay_ces4_map$residuals ==-43.16571,])
View(fin_bay_ces4_map)
colnames(ces_data_4)
ces4_clean <- ces_data_4 %>%
select(!ends_with("Pctl"))
sum(is.na(ces4_clean$Poverty))
ca_tracts <- tracts("CA")
# mutate function
ces4_clean <- ces_data_4 %>%
select(!ends_with("Pctl"))
ca_tracts <- tracts("CA")
ca_tracts <- tracts("CA")
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
select(GEOID) %>%
mutate(GEOID = as.numeric(GEOID)),
by = c("Census Tract" = "GEOID")
)
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = as.numeric(GEOID)),
by = c("Census Tract" = "GEOID")
) %>%
st_as_sf()
bay_ces4_map_a <- ces4_map[ces4_map$`California County`== "Alameda",]
bay_ces4_map_n <- ces4_map[ces4_map$`California County`== "Napa",]
bay_ces4_map_n <- ces4_map[ces4_map$`California County`== "Napa",]
bay_ces4_map_sc <- ces4_map[ces4_map$`California County`== "Santa Clara",]
bay_ces4_map_cc <- ces4_map[ces4_map$`California County`== "Contra Costa",]
bay_ces4_map_sf <- ces4_map[ces4_map$`California County`== "San Francisco",]
bay_ces4_map_s <- ces4_map[ces4_map$`California County`== "Solano",]
bay_ces4_map_m <- ces4_map[ces4_map$`California County`== "Marin",]
bay_ces4_map_sm <- ces4_map[ces4_map$`California County`== "San Mateo",]
bay_ces4_map_s <- ces4_map[ces4_map$`California County`== "Sonoma",]
fin_bay_ces4_map <- rbind(bay_ces4_map_a,bay_ces4_map_n,bay_ces4_map_sc,bay_ces4_map_cc,bay_ces4_map_sf,bay_ces4_map_s,bay_ces4_map_m,bay_ces4_map_sm,bay_ces4_map_s)
mapview(fin_bay_ces4_map, zcol= "Asthma")
